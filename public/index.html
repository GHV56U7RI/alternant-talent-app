<!doctype html>
<html lang="fr"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Alternant Talent â€“ Offres</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:20px}
  h1{margin:0 0 8px} section{margin:24px 0} input,button{font-size:16px}
  ul{padding-left:16px} li{margin:8px 0}
  pre{background:#f6f7f9;padding:12px;border-radius:8px;overflow:auto}
</style>
</head><body>
<h1>Alternant Talent</h1>

<section>
  <h2>ğŸ‘©â€ğŸ“ Espace Ã©tudiant â€“ demo rapide</h2>
  <form id="signup">
    <input type="email" name="email" placeholder="email" required>
    <input type="password" name="password" placeholder="mot de passe" required>
    <button>S'inscrire</button> <span id="signup-msg"></span>
  </form>
  <form id="login" style="margin-top:8px">
    <input type="email" name="email" placeholder="email">
    <input type="password" name="password" placeholder="mot de passe">
    <button>Se connecter</button> <span id="login-msg"></span>
  </form>
  <button id="logout" style="margin-top:8px">Se dÃ©connecter</button>
  <pre id="me">{}</pre>
</section>

<section>
  <h2>ğŸ”¥ Offres rÃ©centes (France par dÃ©faut)</h2>
  <input id="q" placeholder="Recherche (ex: data, lyonâ€¦)" style="width:100%;padding:10px;margin:8px 0">
  <button id="search">Rechercher</button>
  <label style="margin-left:8px"><input type="checkbox" id="world"> Monde entier</label>
  <ul id="list"></ul>
</section>

<script>
async function api(path, opts={}) {
  const res = await fetch(path, { credentials:'include', ...opts });
  const txt = await res.text();
  try { return { ok: res.ok, status: res.status, json: JSON.parse(txt) }; }
  catch { return { ok: res.ok, status: res.status, text: txt }; }
}
async function refreshMe(){
  const r = await api('/api/student/auth/me');
  document.querySelector('#me').textContent = JSON.stringify(r.json || r.text || r, null, 2);
}
document.querySelector('#signup').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const f = new FormData(e.target);
  const r = await api('/api/student/auth/register', {
    method:'POST', headers:{'content-type':'application/json'},
    body: JSON.stringify({ email:f.get('email'), password:f.get('password') })
  });
  document.querySelector('#signup-msg').textContent = r.ok ? 'Inscription OK âœ…' : 'Erreur âŒ';
  refreshMe();
});
document.querySelector('#login').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const f = new FormData(e.target);
  const r = await api('/api/student/auth/login', {
    method:'POST', headers:{'content-type':'application/json'},
    body: JSON.stringify({ email:f.get('email'), password:f.get('password') })
  });
  document.querySelector('#login-msg').textContent = r.ok ? 'ConnectÃ© ğŸ”“' : 'Identifiants invalides âŒ';
  refreshMe();
});
document.querySelector('#logout').addEventListener('click', async ()=>{
  await api('/api/student/auth/logout', { method:'POST' });
  refreshMe();
});
async function loadJobs(){
  const q = document.querySelector('#q').value.trim();
  const world = document.querySelector('#world').checked ? '&world=1' : '';
  const base = '/api/jobs?limit=20';
  const url = q ? `${base}&q=${encodeURIComponent(q)}${world}` : `${base}${world}`;
  const r = await api(url);
  const ul = document.querySelector('#list'); ul.innerHTML='';
  (r.json?.jobs||[]).forEach(j=>{
    const li = document.createElement('li');
    li.innerHTML = `<b>${j.title}</b> â€” ${j.company} Â· ${j.location} Â· <a href="${j.url}" target="_blank" rel="noopener">Postuler</a>`;
    ul.appendChild(li);
  });
}
document.querySelector('#search').addEventListener('click', loadJobs);
refreshMe(); loadJobs();
</script>
</body></html>
