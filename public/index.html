<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Liste des offres d'alternance">
<title>Alternant Talent â€“ Offres</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:20px}
  #search-bar{display:flex;gap:8px;margin-bottom:16px}
  #main{display:flex;gap:16px}
  #list{list-style:none;padding:0;margin:0;width:40%;max-height:80vh;overflow:auto}
  #list li{padding:8px;border-bottom:1px solid #ccc;cursor:pointer}
  #details{flex:1;border:1px solid #ccc;padding:16px;border-radius:4px;overflow:auto}
</style>
  <link rel="stylesheet" href="/assets/nav.css">
</head>
<body>
<nav>
  <a href="/index.html">Accueil</a>
  <a href="/students/index.html">Ã‰tudiants</a>
  <a href="/employers/index.html">Employeurs</a>
</nav>

<h1>Alternant Talent</h1>
<div id="search-bar">
  <input id="profession" placeholder="profession">
  <input id="localisation" placeholder="localisation">
  <button id="search">Rechercher</button>
</div>
<div id="main">
  <ul id="list"></ul>
  <div id="details">SÃ©lectionnez une offre pour voir les dÃ©tails.</div>
</div>
<script>
async function api(path, opts={}) {
  const res = await fetch(path, { credentials:'include', ...opts });
  const txt = await res.text();
  try { return { ok: res.ok, status: res.status, json: JSON.parse(txt) }; }
  catch { return { ok: res.ok, status: res.status, text: txt }; }
}
async function loadJobs(){
  const profession = document.querySelector('#profession').value.trim();
  const location = document.querySelector('#localisation').value.trim();
  const url = `/api/jobs?q=${encodeURIComponent(profession)}&location=${encodeURIComponent(location)}`;
  const r = await api(url);
  const ul = document.querySelector('#list');
  ul.innerHTML='';
  (r.json?.jobs||[]).forEach(j=>{
    const li = document.createElement('li');
    li.innerHTML = `<b>${j.title}</b> â€” ${j.company} Â· ${j.location}`;
    li.addEventListener('click',()=>loadDetails(j.id));
    ul.appendChild(li);
  });
}
async function loadDetails(id){
  const d = document.querySelector('#details');
  d.innerHTML='';
  const job = await api(`/api/jobs/${encodeURIComponent(id)}`);
  if(!job.json){
    d.textContent = 'DÃ©tails indisponibles';
    return;
  }
  const o = job.json;
  d.innerHTML = `<h2>${o.title||''}</h2><p>${o.company||''} - ${o.location||''}</p><p>${o.description||''}</p>`;
  const stats = await api(`/api/stats/offer/${encodeURIComponent(id)}`);
  if(stats.json){
    const s = stats.json;
    d.innerHTML += `<p>ğŸ‘ï¸ ${s.views||0} Â· ğŸ”— ${s.clicks||0} Â· ğŸ“ ${s.applies||0}</p>`;
  }
}
document.querySelector('#search').addEventListener('click',loadJobs);
loadJobs();
</script>
</body>
</html>
