<!doctype html><html lang="fr"><meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Alternant Talent · Espace Étudiant</title>
<link rel="icon" href="/favicon.svg">
<body style="font-family:system-ui, -apple-system, Segoe UI, Roboto, sans-serif; max-width:720px; margin:40px auto; padding:0 16px">
  <h1>👋 Espace Étudiant</h1>

  <section style="display:grid; gap:16px; grid-template-columns:1fr 1fr">
    <form id="signup" style="border:1px solid #ddd; border-radius:12px; padding:16px">
      <h2>Créer un compte</h2>
      <input name="email" type="email" required placeholder="email" style="width:100%;padding:10px;margin:8px 0">
      <input name="password" type="password" required placeholder="mot de passe" style="width:100%;padding:10px;margin:8px 0">
      <button>Inscription</button>
      <p id="signup-msg" style="color:#0a0"></p>
    </form>

    <form id="login" style="border:1px solid #ddd; border-radius:12px; padding:16px">
      <h2>Se connecter</h2>
      <input name="email" type="email" required placeholder="email" style="width:100%;padding:10px;margin:8px 0">
      <input name="password" type="password" required placeholder="mot de passe" style="width:100%;padding:10px;margin:8px 0">
      <button>Connexion</button>
      <p id="login-msg" style="color:#a00"></p>
    </form>
  </section>

  <section style="margin-top:24px; border:1px solid #ddd; border-radius:12px; padding:16px">
    <h2>👤 Session</h2>
    <pre id="me" style="white-space:pre-wrap;background:#fafafa;padding:12px;border-radius:8px;border:1px dashed #eee">Non connecté</pre>
    <button id="logout">Se déconnecter</button>
  </section>

  <section style="margin-top:24px; border:1px solid #ddd; border-radius:12px; padding:16px">
    <h2>🔥 Offres récentes (France)</h2>
    <input id="q" placeholder="Recherche (ex: data, lyon…)" style="width:100%;padding:10px;margin:8px 0">
    <button id="search">Rechercher</button>
    <ul id="list"></ul>
  </section>

<script>
async function api(path, opts={}) {
  const res = await fetch(path, { credentials:'include', ...opts });
  const txt = await res.text();
  try { return { ok: res.ok, status: res.status, json: JSON.parse(txt) }; }
  catch { return { ok: res.ok, status: res.status, text: txt }; }
}
async function refreshMe(){
  const r = await api('/api/student/auth/me');
  document.querySelector('#me').textContent = JSON.stringify(r.json || r.text || r, null, 2);
}
document.querySelector('#signup').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const f = new FormData(e.target);
  const r = await api('/api/student/auth/register', {
    method:'POST', headers:{'content-type':'application/json'},
    body: JSON.stringify({ email:f.get('email'), password:f.get('password') })
  });
  document.querySelector('#signup-msg').textContent = r.ok ? 'Inscription OK ✅' : 'Erreur ❌';
  refreshMe();
});
document.querySelector('#login').addEventListener('submit', async (e)=>{
  e.preventDefault();
  const f = new FormData(e.target);
  const r = await api('/api/student/auth/login', {
    method:'POST', headers:{'content-type':'application/json'},
    body: JSON.stringify({ email:f.get('email'), password:f.get('password') })
  });
  document.querySelector('#login-msg').textContent = r.ok ? 'Connecté 🔓' : 'Identifiants invalides ❌';
  refreshMe();
});
document.querySelector('#logout').addEventListener('click', async ()=>{
  await api('/api/student/auth/logout', { method:'POST' });
  refreshMe();
});
async function loadJobs(){
  const q = document.querySelector('#q').value.trim();
  const url = q ? `/api/jobs?limit=20&q=${encodeURIComponent(q)}` : '/api/jobs?limit=20';
  const r = await api(url);
  const ul = document.querySelector('#list'); ul.innerHTML='';
  (r.json?.jobs||[]).forEach(j=>{
    const li = document.createElement('li');
    li.innerHTML = `<b>${j.title}</b> — ${j.company} · ${j.location} · <a href="${j.url}" target="_blank" rel="noopener">Postuler</a>`;
    ul.appendChild(li);
  });
}
document.querySelector('#search').addEventListener('click', loadJobs);
refreshMe(); loadJobs();
</script>
</body></html>
